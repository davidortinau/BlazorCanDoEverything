@page "/projects"
@inject IProjectRepository ProjectRepository
@inject NavigationManager Navigation

<PageTitle>Projects</PageTitle>

<h3 style="margin-bottom: 1rem; color: var(--md-sys-color-on-background);">Projects</h3>

@if (_isLoading)
{
    <MBCircularProgress />
}
else
{
    <div class="flex flex-col gap-3">
        @foreach (var project in _projects)
        {
            <div class="card" style="cursor: pointer;" @onclick="() => NavigateToProject(project)">
                <div class="flex flex-row items-center">
                    <div class="flex flex-col flex-1">
                        <h5 style="margin: 0 0 0.25rem 0; color: var(--md-sys-color-on-surface);">@project.Name</h5>
                        <span style="color: var(--md-sys-color-on-surface-variant);">@project.Description</span>
                    </div>
                    <span class="chip" style="background-color: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container); padding: 0.25rem 0.75rem; border-radius: 16px;">
                        @(project.Tasks?.Count ?? 0) tasks
                    </span>
                </div>
            </div>
        }
    </div>
}

<AddButton Title="Add Project" OnClick="@(() => Navigation.NavigateTo("/project/0"))" />

@code {
    private bool _isLoading = true;
    private List<Project> _projects = [];

    protected override async Task OnInitializedAsync()
    {
        await LoadData();
    }

    private async Task LoadData()
    {
        _isLoading = true;
        try
        {
            _projects = await ProjectRepository.ListAsync();
        }
        finally
        {
            _isLoading = false;
        }
    }

    private void NavigateToProject(Project project)
    {
        Navigation.NavigateTo($"/project/{project.ID}");
    }
}
